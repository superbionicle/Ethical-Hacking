# Firewall

## Makefile

```bash
obj-m += block_telnet_and_ICMP.o
all:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
	make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean

ins:
	sudo dmesg -C
	sudo insmod block_telnet_and_ICMP.ko

rm:
	sudo rmmod block_telnet_and_ICMP
```

## Aceept ping from int to ext

```bash
iptables -A FORWARD -i eth1 -o eth0 -p icmp --icmp-type echo-request -j ACCEPT
iptables -A FORWARD -o eth1 -i eth0 -p icmp --icmp-type echo-reply -j ACCEPT
```

## Drop all the rest

```bash
iptables -A FORWARD -p icpm -j DROP
```

##

```bash
iptables -A FORWARD -i eth0 -p tcp -d 192.168.60.5 --dport 23 -j ACCEPT
iptables -A FORWARD -i eth0 -p tcp --dport 23 -j DROP
iptables -A FORWARD -o eth0 -p tcp --dport 23 -j DROP
```

##

```bash
iptables -A FORWARD -i eht0 -p tcp -d 192.168.60.5 --dport 23 -j ACCEPT
iptables -A FORWARD -i eth0 -p tcp --dport 23 -j DROP
iptables -A FORWARD -p tcp -m connntack --cstate ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -p tcp -i eht0 -o eth1 --dport 23 --syn -m conntrack --ctstate NEW -j ACCEPT
iptables -A FORWARD -i eth0 -p tcp --dport 23 -j DROP
```

<!-- ## Block telnet and ICMP


## Print info

```c
#include <linux/kernel.h>
#include <linux/module.h>
#include <linux/netfilter.h>
#include <linux/netfilter_ipv4.h>
#include <linux/ip.h>
#include <linux/tcp.h>
#include <linux/udp.h>
#include <linux/if_ether.h>
#include <linux/inet.h>


``` -->